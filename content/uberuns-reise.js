// Generated by CoffeeScript 1.7.1
var UberunsReise,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

UberunsReise = (function(_super) {
  __extends(UberunsReise, _super);

  function UberunsReise() {
    this.reisehack = __bind(this.reisehack, this);
    this.setupMap = __bind(this.setupMap, this);
    this.onDOMVisible = __bind(this.onDOMVisible, this);
    this.core = window.core;
    this.core.requestFunction("ContentViewer.requestInstance", (function(_this) {
      return function(cView) {
        return _this.contentViewer = cView();
      };
    })(this));
    this.metadata = {
      r1: {
        title: "&Ouml;sterreich &amp; Ungarn",
        caption: "Konzertreise 2012",
        textID: "#osterreich",
        linkBilder: "#!/bilder/category/2",
        thumbnail: "/img/ungarn.jpg"
      },
      r2: {
        title: "Deutschland &amp; Holland",
        caption: "Konzertreise 2013",
        textID: "#deutschland",
        linkBilder: "#!/bilder/category/3"
      },
      r3: {
        title: "Spanien",
        caption: "Konzertreise 2014",
        textID: "#spanien",
        linkBilder: "#!/bilder/category/4"
      }
    };
  }

  UberunsReise.prototype.onLoad = function() {
    var i, _i, _results;
    $.when($.getScript("/code/jquery.vmap.js"), $.getScript("/code/jquery.vmap.europe.js"), $.getScript("/code/jquery.vmap.world.js"), $.Deferred(function(deferred) {
      return $(deferred.resolve);
    })).done(function() {
      return window.core.release();
    });
    _results = [];
    for (i = _i = 0; _i <= 2; i = ++_i) {
      _results.push($(".reise-tile").eq(i).hover(function() {
        return $(this).find("h1").addClass("fade");
      }, function() {
        return $(this).find("h1").removeClass("fade");
      }));
    }
    return _results;
  };

  UberunsReise.prototype.onDOMVisible = function() {
    if (!window.ie) {
      this.reisehack();
      $(window).on("resize", this.reisehack);
    }
    return this.setupMap();
  };

  UberunsReise.prototype.onUnloadChild = function() {
    return $(window).off("resize", this.reisehack);
  };

  UberunsReise.prototype.notifyHashChange = function(newHash) {
    var elem, h, metaobj, number, offs, w;
    if (newHash.lastIndexOf("/info/", 0) === 0) {
      number = parseInt(newHash.substr(6, newHash.length));
      metaobj = void 0;
      switch (number) {
        case 1:
          metaobj = this.metadata.r1;
          break;
        case 2:
          metaobj = this.metadata.r2;
          break;
        case 3:
          metaobj = this.metadata.r3;
      }
      w = $(window).width();
      h = $(window).height();
      elem = $("#rt" + number);
      offs = elem.offset();
      this.contentViewer.open({
        left: function() {
          return (w / 2) - (1000 / 2);
        },
        top: function() {
          return (h / 2) - (600 / 2);
        },
        right: function() {
          return (w / 2) - (1000 / 2);
        },
        height: function() {
          return 600;
        },
        chapter: false,
        title: metaobj.title,
        caption: metaobj.caption,
        revertHash: "#!/uberuns/reise",
        content: $("#content-reise").html(),
        animate: true,
        startingPos: {
          left: offs.left,
          top: offs.top,
          width: elem.width(),
          height: elem.height()
        }
      });
      return this.populate(metaobj.textID, metaobj.linkBilder, metaobj.thumbnail);
    }
  };

  UberunsReise.prototype.populate = function(textPtr, bilderLink, thumbnail) {
    $(".reise-left-tile").attr("href", bilderLink);
    $(".reise-left-tile img").attr("src", thumbnail);
    $(".reise-right-titel").html($(textPtr).children("h1").html());
    return $(".reise-right-content").html($(textPtr).children("p").html());
  };

  UberunsReise.prototype.acquireLoadingLock = function() {
    return true;
  };

  UberunsReise.prototype.setupMap = function() {
    var hReiseTile, wReiseTile;
    wReiseTile = $(".reise-tile").eq(0).width();
    hReiseTile = $(".reise-tile").eq(0).height();
    $("#map").css({
      height: hReiseTile,
      width: wReiseTile
    });
    console.log($("#map").width());
    $('#map').vectorMap({
      map: 'europe_en',
      backgroundColor: "#1a171a",
      borderColor: '#1a171a',
      borderWidth: 0,
      color: '#ffffff',
      hoverColor: '#999999',
      enableZoom: false,
      showTooltip: true,
      colors: {
        de: "#199250",
        es: "#305596",
        gb: "#199250",
        at: "#199250",
        dk: "#199250",
        cz: "#199250",
        fr: "#199250",
        it: "#199250",
        se: "#199250",
        no: "#199250",
        nl: "#199250",
        ch: "#199250",
        hu: "#199250",
        si: "#199250",
        hr: "#199250",
        ro: "#199250"
      }
    });
    return $("#map-world").vectorMap({
      map: 'world_en',
      backgroundColor: "#1a171a",
      borderColor: '#1a171a',
      color: '#ffffff',
      hoverColor: '#999999',
      enableZoom: false,
      showTooltip: true,
      colors: {
        de: "#199250",
        es: "#305596",
        gb: "#199250",
        at: "#199250",
        dk: "#199250",
        cz: "#199250",
        fr: "#199250",
        it: "#199250",
        se: "#199250",
        no: "#199250",
        nl: "#199250",
        ch: "#199250",
        hu: "#199250",
        si: "#199250",
        hr: "#199250",
        ro: "#199250",
        us: "#199250"
      }
    });
  };

  UberunsReise.prototype.reisehack = function() {
    var wReiseTile;
    wReiseTile = $(".reise-tile").eq(0).height();
    return $("#reise-onleft").css({
      height: 2 * wReiseTile + 10
    });
  };

  return UberunsReise;

})(ChildPage);

window.core.insertChildPage(new UberunsReise());
