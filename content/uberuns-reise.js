// Generated by CoffeeScript 1.7.1
var UberunsReise,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

UberunsReise = (function(_super) {
  __extends(UberunsReise, _super);

  function UberunsReise() {
    this.reisehack = __bind(this.reisehack, this);
    this.setupMap = __bind(this.setupMap, this);
    this.resizeMap = __bind(this.resizeMap, this);
    this.onDOMVisible = __bind(this.onDOMVisible, this);
    this.core = window.core;
    this.core.requestFunction("ContentViewer.requestInstance", (function(_this) {
      return function(cView) {
        return _this.contentViewer = cView();
      };
    })(this));
  }

  UberunsReise.prototype.onLoad = function() {
    return $.when($.getScript("/code/jquery.vmap.js"), $.getScript("/code/jquery.vmap.europe.js"), $.Deferred(function(deferred) {
      return $(deferred.resolve);
    })).then(function() {
      console.log("sucess");
      return window.core.release();
    }, function() {
      console.log("fail");
      return window.core.release();
    });
  };

  UberunsReise.prototype.onDOMVisible = function() {
    console.log("in onASDvisible");
    this.reisehack();
    $(window).on("resize", this.reisehack);
    this.setupMap();
    return $(window).on("resize", this.resizeMap);
  };

  UberunsReise.prototype.onUnloadChild = function() {
    $(window).off("resize", this.reisehack);
    return $(window).off("resize", this.resizeMap);
  };

  UberunsReise.prototype.notifyHashChange = function(newHash) {
    var number;
    console.log(newHash);
    if (newHash.lastIndexOf("/info/", 0) === 0) {
      return number = parseInt(newHash.substr(6, newHash.length));
    }
  };

  UberunsReise.prototype.acquireLoadingLock = function() {
    return true;
  };

  UberunsReise.prototype.resizeMap = function() {
    $("#map").children().remove();
    $(".jqvmap-label").remove();
    return this.setupMap();
  };

  UberunsReise.prototype.setupMap = function() {
    var hReiseTile, wReiseTile;
    wReiseTile = $(".reise-tile").eq(0).width();
    hReiseTile = $(".reise-tile").eq(0).height();
    $("#map").css({
      height: hReiseTile,
      width: wReiseTile
    });
    console.log($("#map").width());
    return $('#map').vectorMap({
      map: 'europe_en',
      backgroundColor: "#1a171a",
      color: '#ffffff',
      hoverColor: '#999999',
      enableZoom: false,
      showTooltip: false
    });
  };

  UberunsReise.prototype.reisehack = function() {
    var wReiseTile;
    wReiseTile = $(".reise-tile").eq(0).height();
    return $("#reise-onleft").css({
      height: 2 * wReiseTile + 10
    });
  };

  return UberunsReise;

})(ChildPage);

window.core.insertChildPage(new UberunsReise());
