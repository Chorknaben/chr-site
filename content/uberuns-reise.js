// Generated by CoffeeScript 1.7.1
var UberunsReise,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

UberunsReise = (function(_super) {
  __extends(UberunsReise, _super);

  function UberunsReise() {
    this.reisehack = __bind(this.reisehack, this);
    this.setupMap = __bind(this.setupMap, this);
    this.resizeMap = __bind(this.resizeMap, this);
    this.onDOMVisible = __bind(this.onDOMVisible, this);
    this.core = window.core;
    this.core.requestFunction("ContentViewer.requestInstance", (function(_this) {
      return function(cView) {
        return _this.contentViewer = cView();
      };
    })(this));
  }

  UberunsReise.prototype.onLoad = function() {
    var i, _i, _results;
    $.when($.getScript("/code/jquery.vmap.js"), $.getScript("/code/jquery.vmap.europe.js"), $.getScript("/code/jquery.vmap.world.js"), $.Deferred(function(deferred) {
      return $(deferred.resolve);
    })).done(function() {
      return window.core.release();
    });
    _results = [];
    for (i = _i = 0; _i <= 2; i = ++_i) {
      _results.push($(".reise-tile").eq(i).hover(function() {
        return $(this).find("h1").addClass("fade");
      }, function() {
        return $(this).find("h1").removeClass("fade");
      }));
    }
    return _results;
  };

  UberunsReise.prototype.onDOMVisible = function() {
    if (!window.ie) {
      this.reisehack();
      $(window).on("resize", this.reisehack);
      this.overflowText();
      $(window).on("resize", this.overflowText);
    }
    this.setupMap();
    return $(window).on("resize", this.resizeMap);
  };

  UberunsReise.prototype.overflowText = function() {
    console.log("i exec");
    return $($(".reise-tile")[4]).overflowTo($(".reise-tile")[5]);
  };

  UberunsReise.prototype.onUnloadChild = function() {
    $(window).off("resize", this.reisehack);
    return $(window).off("resize", this.resizeMap);
  };

  UberunsReise.prototype.notifyHashChange = function(newHash) {
    var elem, h, number, offs, w;
    if (newHash.lastIndexOf("/info/", 0) === 0) {
      number = parseInt(newHash.substr(6, newHash.length));
      w = $(window).width();
      h = $(window).height();
      elem = $("#rt" + number);
      offs = elem.offset();
      return this.contentViewer.open({
        left: function() {
          return $("#uberuns-cnt").offset().left + 10;
        },
        top: function() {
          return $(".reise-tile").offset().top;
        },
        right: function() {
          return w - $("#uberuns-cnt").width() - (w * 0.04) - 2;
        },
        height: function() {
          return $("#uberuns-cnt").height() + 10;
        },
        chapter: false,
        title: "MOSKAU &amp; STALINGRAD",
        caption: "1945",
        revertHash: "#!/uberuns/reise",
        content: "<p>Prosciutto sirloin filet mignon pancetta. Rump frankfurter tail, fatback cow tenderloin ham hock. Strip steak meatball beef shank doner jowl turducken bacon t-bone biltong salami. Prosciutto meatball pancetta filet mignon brisket ham jowl sirloin. Biltong ground round brisket, sirloin tail corned beef pig pork chop ball tip shoulder beef ribs frankfurter beef pork salami.</p>",
        animate: true,
        startingPos: {
          left: offs.left,
          top: offs.top,
          width: elem.width(),
          height: elem.height()
        }
      });
    }
  };

  UberunsReise.prototype.acquireLoadingLock = function() {
    return true;
  };

  UberunsReise.prototype.resizeMap = function() {
    $("#map").remove();
    $(".jqvmap-label").remove();
    $(".reise-tile").eq(3).append($("<div>").attr("id", "map"));
    return this.setupMap();
  };

  UberunsReise.prototype.setupMap = function() {
    var hReiseTile, wReiseTile;
    wReiseTile = $(".reise-tile").eq(0).width();
    hReiseTile = $(".reise-tile").eq(0).height();
    $("#map").css({
      height: hReiseTile,
      width: wReiseTile
    });
    console.log($("#map").width());
    $('#map').vectorMap({
      map: 'europe_en',
      backgroundColor: "#1a171a",
      color: '#ffffff',
      hoverColor: '#999999',
      enableZoom: false,
      showTooltip: true,
      colors: {
        de: "#004477",
        es: "#9b4f37",
        gb: "#004477",
        at: "#004477",
        dk: "#004477",
        cz: "#004477",
        fr: "#004477",
        it: "#004477",
        se: "#004477",
        no: "#004477",
        nl: "#004477",
        ch: "#004477",
        hu: "#004477",
        si: "#004477",
        hr: "#004477",
        ro: "#004477"
      }
    });
    return $("#map-world").vectorMap({
      map: 'world_en',
      backgroundColor: "#1a171a",
      color: '#ffffff',
      hoverColor: '#999999',
      enableZoom: false,
      showTooltip: true,
      colors: {
        de: "#004477",
        es: "#9b4f37",
        gb: "#004477",
        at: "#004477",
        dk: "#004477",
        cz: "#004477",
        fr: "#004477",
        it: "#004477",
        se: "#004477",
        no: "#004477",
        nl: "#004477",
        ch: "#004477",
        hu: "#004477",
        si: "#004477",
        hr: "#004477",
        ro: "#004477",
        us: "#004477"
      }
    });
  };

  UberunsReise.prototype.reisehack = function() {
    var wReiseTile;
    wReiseTile = $(".reise-tile").eq(0).height();
    return $("#reise-onleft").css({
      height: 2 * wReiseTile + 10
    });
  };

  return UberunsReise;

})(ChildPage);

window.core.insertChildPage(new UberunsReise());
