// Generated by CoffeeScript 1.7.1
var Constants, Core,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

Constants = (function() {
  function Constants() {}

  Constants.SELECTOR_TILE = ".tile-content";

  Constants.SELECTOR_NAV = ".navitem nav";

  Constants.tileResolver = [["Über uns", "uberuns"], ["Stiftung", "stiftung"], ["Presse", "presse"], ["Unterstützen", "unterstutzen"], ["Shop", "shop"], ["Kalender", "cal"], ["Bilder", "bilder"]];

  return Constants;

})();

Core = (function() {
  var debug;

  function Core() {
    this.getScrollHandler = __bind(this.getScrollHandler, this);
  }

  Core.prototype.bgSrc = "/" + ($(window).width()) + "/" + ($(window).height() - 90) + "/";

  Core.prototype.scrollHandlers = {};

  Core.prototype.state = {
    scrolledDown: false,
    currentURL: "null",
    currentPage: "null"
  };

  debug = function(msg) {
    return console.log("Core: " + msg);
  };

  Core.prototype.construct = function() {};

  Core.prototype.handleHash = function() {
    var i, _i, _results;
    if (window.location.hash !== "") {
      debug("Hash detected");
      _results = [];
      for (i = _i = 0; _i <= 7; i = ++_i) {
        if ("#" + Constants.tileResolver[i][1] === window.location.hash) {
          i++;
          new Tile(i, Constants).onClick();
          break;
        } else {
          _results.push(void 0);
        }
      }
      return _results;
    }
  };

  Core.prototype.injectBackground = function() {
    debug(this.bgSrc);
    return $("<img>", {
      src: this.bgSrc + "bg"
    }).appendTo($("#bg")).load(function() {
      return $(this).fadeIn(300);
    });
  };

  Core.prototype.injectTileBackgrounds = function() {
    var i, tile, _i, _results;
    _results = [];
    for (i = _i = 12; _i >= 0; i = --_i) {
      $("#" + i).css({
        "background-image": "url(" + (this.bgSrc + i) + ")"
      });
      tile = new Tile(i);
      _results.push($("#" + i).click(tile.onClick));
    }
    return _results;
  };

  Core.prototype.loadEffects = function() {
    var stl;
    stl = $(Constants.SELECTOR_TILE);
    return stl.each(function(index, obj) {
      obj = $(obj);
      return obj.hover(function() {
        obj.children("a").children(".hoveroverlay").animate({
          opacity: "0.7"
        }, 100);
        return $(stl.not(".hoveroverlay")[index - 1]).children(".hoveroverlay").animate({
          opacity: "0"
        }, 100);
      }, function() {
        obj.children("a").children(".hoveroverlay").animate({
          opacity: "0"
        }, 100);
        return $(stl[index - 1]).children("a").children(".hoveroverlay").animate({
          opacity: "0"
        }, 100);
      });
    });
  };

  Core.prototype.getScrollHandler = function(event) {
    var key, val, _ref, _results;
    _ref = this.scrollHandlers;
    _results = [];
    for (key in _ref) {
      val = _ref[key];
      _results.push(val(event));
    }
    return _results;
  };

  Core.prototype.registerScrollHandler = function(name, callback) {
    return this.scrollHandlers[name] = callback;
  };

  Core.prototype.deleteScrollHandler = function(name) {
    var key, _i, _len, _ref, _results;
    _ref = this.scrollHandlers;
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      key = _ref[_i];
      if (key === name) {
        _results.push(delete this.scrollHandlers[key]);
      } else {
        _results.push(void 0);
      }
    }
    return _results;
  };

  return Core;

})();

window.core = new Core;

window.constants = Constants;

$(function() {
  var c;
  c = window.core;
  c.handleHash();
  c.injectBackground();
  c.injectTileBackgrounds();
  c.loadEffects();
  $(window).scroll(c.getScrollHandler);
  c.registerScrollHandler("onTop", function(event) {
    if ($(window).scrollTop() === 0 && $(".ctitle").html() !== "St.-Martins-Chorknaben Biberach") {
      return setTimeout(function() {
        if ($(window).scrollTop() === 0) {
          window.location.hash = "#";
          $(".ctitle").fadeTo(500, 0);
          return setTimeout(function() {
            $(".ctitle").html("St.-Martins-Chorknaben Biberach");
            return $(".ctitle").fadeTo(200, 1);
          }, 500);
        }
      }, 1000);
    }
  });
  c.registerScrollHandler("scrollUpwards", function(event) {
    if ($(window).scrollTop() < $(window).height() - 40 && c.state["scrolledDown"]) {
      $(".header-nav").fadeTo(200, 0);
      return c.state["scrolledDown"] = false;
    }
  });
  return c.registerScrollHandler("onLoadChild", function(event) {
    if ($(window).scrollTop() > $(window).height() - 40 && !c.state["scrolledDown"]) {
      c.state["scrolledDown"] = true;
      $(".header-nav").fadeTo(200, 1);
      if (c.state["currentURL"] !== "null") {
        window.location.hash = c.state["currentURL"];
      }
      if (c.state["currentPage"] !== "null") {
        $(".ctitle").fadeTo(200, 0);
        return setTimeout(function() {
          return $(".ctitle").html("Chorknaben // " + c.state["currentPage"]).fadeTo(200, 1);
        }, 200);
      }
    }
  });
});
